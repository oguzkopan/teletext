<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animation Performance Optimization Demo</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #00ff00;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #ffff00;
      text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
    }

    .demo-section {
      margin: 30px 0;
      padding: 20px;
      border: 2px solid #00ff00;
      border-radius: 5px;
    }

    .demo-section h2 {
      color: #00ffff;
      margin-top: 0;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .stat-box {
      background: rgba(0, 255, 0, 0.1);
      padding: 15px;
      border: 1px solid #00ff00;
      border-radius: 3px;
    }

    .stat-label {
      color: #ffff00;
      font-size: 0.9em;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
    }

    .stat-value.good {
      color: #00ff00;
    }

    .stat-value.warning {
      color: #ffff00;
    }

    .stat-value.bad {
      color: #ff0000;
    }

    .animation-demo {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .demo-box {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #00ff00;
      border-radius: 5px;
      font-size: 2em;
    }

    /* GPU-Accelerated Animation (GOOD) */
    .optimized {
      animation: optimized-slide 2s ease-in-out infinite;
    }

    @keyframes optimized-slide {
      0%, 100% {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
      50% {
        transform: translateX(50px) scale(1.2);
        opacity: 0.7;
      }
    }

    /* Non-Optimized Animation (BAD) */
    .non-optimized {
      animation: non-optimized-slide 2s ease-in-out infinite;
    }

    @keyframes non-optimized-slide {
      0%, 100% {
        left: 0;
        width: 100px;
      }
      50% {
        left: 50px;
        width: 120px;
      }
    }

    /* Will-Change Example */
    .will-change-demo {
      will-change: transform, opacity;
      animation: will-change-animation 1s ease-in-out infinite;
    }

    @keyframes will-change-animation {
      0%, 100% {
        transform: rotate(0deg);
      }
      50% {
        transform: rotate(180deg);
      }
    }

    /* Degraded Mode Simulation */
    body.degraded .animation-complexity-complex {
      animation: none !important;
    }

    body.degraded .animation-complexity-moderate {
      animation-duration: 0.5s !important;
    }

    .complex-animation {
      animation: complex-effect 3s ease-in-out infinite;
    }

    @keyframes complex-effect {
      0%, 100% {
        transform: translateY(0) rotate(0deg) scale(1);
        filter: hue-rotate(0deg);
      }
      50% {
        transform: translateY(-20px) rotate(360deg) scale(1.5);
        filter: hue-rotate(180deg);
      }
    }

    .controls {
      margin: 20px 0;
    }

    button {
      background: #00ff00;
      color: #000;
      border: none;
      padding: 10px 20px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      margin-right: 10px;
      border-radius: 3px;
    }

    button:hover {
      background: #00ffff;
    }

    button:active {
      transform: scale(0.95);
    }

    .log {
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border: 1px solid #00ff00;
      border-radius: 3px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.9em;
    }

    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #00ff00;
      padding-left: 10px;
    }

    .log-entry.warning {
      border-left-color: #ffff00;
      color: #ffff00;
    }

    .log-entry.error {
      border-left-color: #ff0000;
      color: #ff0000;
    }

    .recommendations {
      background: rgba(255, 255, 0, 0.1);
      padding: 15px;
      border: 1px solid #ffff00;
      border-radius: 3px;
      margin: 20px 0;
    }

    .recommendations ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .recommendations li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Animation Performance Optimization Demo</h1>

    <!-- Performance Stats -->
    <div class="demo-section">
      <h2>üìä Performance Metrics</h2>
      <div class="stats">
        <div class="stat-box">
          <div class="stat-label">Current FPS</div>
          <div class="stat-value good" id="current-fps">60</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Average FPS</div>
          <div class="stat-value good" id="average-fps">60</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Min FPS</div>
          <div class="stat-value" id="min-fps">60</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Max FPS</div>
          <div class="stat-value" id="max-fps">60</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Will-Change Elements</div>
          <div class="stat-value" id="will-change-count">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Degraded Mode</div>
          <div class="stat-value" id="degraded-status">No</div>
        </div>
      </div>
    </div>

    <!-- Animation Comparison -->
    <div class="demo-section">
      <h2>‚úÖ GPU-Accelerated vs ‚ùå Non-Optimized</h2>
      <div class="animation-demo">
        <div>
          <p>‚úÖ Optimized (transform + opacity)</p>
          <div class="demo-box optimized">üöÄ</div>
        </div>
        <div>
          <p>‚ùå Non-Optimized (left + width)</p>
          <div class="demo-box non-optimized" style="position: relative;">üêå</div>
        </div>
        <div>
          <p>‚ö° With will-change</p>
          <div class="demo-box will-change-demo">‚ö°</div>
        </div>
        <div>
          <p>üé® Complex Animation</p>
          <div class="demo-box complex-animation animation-complexity-complex">üé®</div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="demo-section">
      <h2>üéõÔ∏è Controls</h2>
      <div class="controls">
        <button onclick="simulateLowFPS()">Simulate Low FPS</button>
        <button onclick="restoreFPS()">Restore FPS</button>
        <button onclick="toggleDegraded()">Toggle Degraded Mode</button>
        <button onclick="addWillChange()">Add Will-Change</button>
        <button onclick="clearWillChange()">Clear Will-Change</button>
        <button onclick="clearLog()">Clear Log</button>
      </div>
    </div>

    <!-- Recommendations -->
    <div class="demo-section">
      <h2>üí° Performance Recommendations</h2>
      <div class="recommendations">
        <ul id="recommendations-list">
          <li>All animations are optimized ‚úÖ</li>
        </ul>
      </div>
    </div>

    <!-- Log -->
    <div class="demo-section">
      <h2>üìù Performance Log</h2>
      <div class="log" id="performance-log">
        <div class="log-entry">Performance monitoring started...</div>
      </div>
    </div>
  </div>

  <script>
    // Simulated performance monitoring
    let currentFPS = 60;
    let fpsHistory = [];
    let willChangeElements = new Set();
    let isDegraded = false;
    let frameCount = 0;
    let lastTime = performance.now();

    function log(message, type = 'info') {
      const logDiv = document.getElementById('performance-log');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateStats() {
      document.getElementById('current-fps').textContent = Math.round(currentFPS);
      document.getElementById('current-fps').className = 
        currentFPS >= 50 ? 'stat-value good' :
        currentFPS >= 30 ? 'stat-value warning' :
        'stat-value bad';

      if (fpsHistory.length > 0) {
        const avg = fpsHistory.reduce((a, b) => a + b, 0) / fpsHistory.length;
        document.getElementById('average-fps').textContent = Math.round(avg);
        document.getElementById('average-fps').className = 
          avg >= 50 ? 'stat-value good' :
          avg >= 30 ? 'stat-value warning' :
          'stat-value bad';

        document.getElementById('min-fps').textContent = Math.round(Math.min(...fpsHistory));
        document.getElementById('max-fps').textContent = Math.round(Math.max(...fpsHistory));
      }

      document.getElementById('will-change-count').textContent = willChangeElements.size;
      document.getElementById('will-change-count').className = 
        willChangeElements.size > 10 ? 'stat-value warning' : 'stat-value good';

      document.getElementById('degraded-status').textContent = isDegraded ? 'Yes' : 'No';
      document.getElementById('degraded-status').className = 
        isDegraded ? 'stat-value warning' : 'stat-value good';
    }

    function updateRecommendations() {
      const list = document.getElementById('recommendations-list');
      list.innerHTML = '';

      if (currentFPS < 30) {
        const li = document.createElement('li');
        li.textContent = `‚ö†Ô∏è Frame rate is below 30 FPS (${Math.round(currentFPS)}). Consider reducing animation complexity.`;
        li.style.color = '#ff0000';
        list.appendChild(li);
      }

      if (willChangeElements.size > 10) {
        const li = document.createElement('li');
        li.textContent = `‚ö†Ô∏è ${willChangeElements.size} elements have will-change. Remove will-change after animations complete.`;
        li.style.color = '#ffff00';
        list.appendChild(li);
      }

      if (isDegraded) {
        const li = document.createElement('li');
        li.textContent = '‚ö†Ô∏è Animations are currently degraded due to low frame rate.';
        li.style.color = '#ffff00';
        list.appendChild(li);
      }

      if (list.children.length === 0) {
        const li = document.createElement('li');
        li.textContent = '‚úÖ All animations are optimized';
        li.style.color = '#00ff00';
        list.appendChild(li);
      }
    }

    function measureFPS() {
      frameCount++;
      const currentTime = performance.now();
      const elapsed = currentTime - lastTime;

      if (elapsed >= 1000) {
        currentFPS = (frameCount * 1000) / elapsed;
        fpsHistory.push(currentFPS);
        
        if (fpsHistory.length > 60) {
          fpsHistory.shift();
        }

        // Check for degradation
        if (currentFPS < 30 && !isDegraded) {
          isDegraded = true;
          document.body.classList.add('degraded');
          log('‚ö†Ô∏è Animations degraded due to low FPS', 'warning');
        } else if (currentFPS >= 45 && isDegraded) {
          isDegraded = false;
          document.body.classList.remove('degraded');
          log('‚úÖ Animations restored - FPS improved', 'info');
        }

        updateStats();
        updateRecommendations();

        frameCount = 0;
        lastTime = currentTime;
      }

      requestAnimationFrame(measureFPS);
    }

    function simulateLowFPS() {
      // Simulate low FPS by adding heavy computation
      log('üêå Simulating low FPS...', 'warning');
      
      const heavyWork = () => {
        for (let i = 0; i < 10000000; i++) {
          Math.sqrt(i);
        }
      };

      const interval = setInterval(heavyWork, 10);
      
      setTimeout(() => {
        clearInterval(interval);
        log('‚úÖ Low FPS simulation ended', 'info');
      }, 5000);
    }

    function restoreFPS() {
      isDegraded = false;
      document.body.classList.remove('degraded');
      log('‚úÖ FPS restored manually', 'info');
      updateStats();
      updateRecommendations();
    }

    function toggleDegraded() {
      isDegraded = !isDegraded;
      document.body.classList.toggle('degraded');
      log(`${isDegraded ? '‚ö†Ô∏è' : '‚úÖ'} Degraded mode ${isDegraded ? 'enabled' : 'disabled'}`, 
          isDegraded ? 'warning' : 'info');
      updateStats();
      updateRecommendations();
    }

    function addWillChange() {
      const boxes = document.querySelectorAll('.demo-box');
      boxes.forEach(box => {
        box.style.willChange = 'transform, opacity';
        willChangeElements.add(box);
      });
      log(`‚ö° Added will-change to ${boxes.length} elements`, 'info');
      updateStats();
      updateRecommendations();
    }

    function clearWillChange() {
      willChangeElements.forEach(el => {
        el.style.willChange = 'auto';
      });
      willChangeElements.clear();
      log('‚úÖ Cleared all will-change properties', 'info');
      updateStats();
      updateRecommendations();
    }

    function clearLog() {
      document.getElementById('performance-log').innerHTML = 
        '<div class="log-entry">Log cleared...</div>';
    }

    // Start monitoring
    requestAnimationFrame(measureFPS);
    log('‚úÖ Performance monitoring started', 'info');
    log('‚ÑπÔ∏è All animations use GPU-accelerated properties (transform, opacity)', 'info');
    log('‚ÑπÔ∏è Frame rate is monitored continuously', 'info');
    log('‚ÑπÔ∏è Animations will degrade automatically if FPS drops below 30', 'info');
  </script>
</body>
</html>
